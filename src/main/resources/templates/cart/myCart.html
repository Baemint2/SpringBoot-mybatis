<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <link href="/css/style/index.css" rel="stylesheet">
    <link href="/css/style/product.css" rel="stylesheet">
    <link href="/css/style/cart.css" rel="stylesheet">
</head>
<body>
<div>
    <div th:fragment="header">
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <a class="nav-header" href="/"><h1>모지히의 이게모지</h1></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                    aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item" sec:authorize="isAuthenticated()">
                        <a href="/member/info" class="nav-link"><span th:text="${loggedUser.nickname}">사용자 이름</span>님</a>
                    </li>
                    <li class="nav-item" sec:authorize="!isAuthenticated()">
                        <a href="/member/signup" role="button" class="btn btn-secondary">회원가입</a>
                    </li>
                    <li class="nav-item" sec:authorize="isAnonymous()">
                        <a href="/member/login" role="button" class="btn btn-success">로그인</a>
                    </li>
                    <li class="nav-item" sec:authorize="hasRole('관리자')">
                        <a href="/admin">관리자페이지</a>
                    </li>
                    <li class="nav-item" sec:authorize="isAuthenticated()">
                        <a href="/member/logout" role="button" class="btn btn-danger">로그아웃</a>
                    </li>
                </ul>
            </div>
        </nav>
        <div class="container mt-4">
            <h2 class="mb-4">장바구니</h2>
            <table class="table">
                <thead>
                <tr>
                    <th scope="col">선택</th>
                    <th scope="col">사진</th>
                    <th scope="col">상품명</th>
                    <th scope="col">수량</th>
                    <th scope="col">상품 금액</th>
                    <th scope="col">삭제</th>
                </tr>
                </thead>
                <tbody>
                <!-- 서버에서 받은 상품 데이터로 반복 -->
                <tr th:each="myItem : ${myItems}" th:data-product-id="${myItem.productId}" class="stockContainer">
                    <td>
                        <input type="checkbox" th:data-cart-item-id="${myItem.cartItemId}">
                    </td>
                    <td><img th:src="${myItem.storedUrl}" alt="상품 이미지" class="img-thumbnail"
                             style="width: 60px; height: 60px;"></td>
                    <td th:text="${myItem.prodName}">상품명</td>
                    <td>
                        <button class="btn btn-secondary btn-sm increase-btn" th:data-count="1">+</button>
                        <span class="quantity" th:data-current-quantity="${myItem.totalQuantity}"
                              th:text="${myItem.totalQuantity}"></span>
                        <button class="btn btn-secondary btn-sm decrease-btn" th:data-count="-1">-</button>
                        <button class="change-stock">변경</button>
                    </td>
                    <td class="price">가격: <span class="formattedPrice" th:text="${myItem.totalPrice}"></span>원</td>
                    <td>
                        <button class="btn btn-danger btn-sm delete-cart-item-btn"
                                th:data-cart-item-id="${myItem.cartItemId}">삭제
                        </button>
                    </td>
                </tr>
                <!-- 상품 데이터 반복 끝 -->
                </tbody>
            </table>
            <div class="d-flex justify-content-between align-items-center mt-4">
                <button class="btn btn-primary" id="btn-delete-selected">선택 제거하기</button>
                <div>
                    <span class="font-weight-bold mr-2" id="totalPrice">Total</span>
                </div>
                <button class="btn btn-success">주문하기</button>
            </div>
        </div>
    </div>
</div>
<script src="/js/app/cart.js"></script>
<script src="/js/app/product.js"></script>
</body>
</html>